-- Drop tables in correct order to avoid FK violations
DROP TABLE WORKS_IN CASCADE CONSTRAINTS;
DROP TABLE PATIENT_MEDICATION CASCADE CONSTRAINTS;
DROP TABLE DOCTOR_MEDICATION CASCADE CONSTRAINTS;
DROP TABLE BILL CASCADE CONSTRAINTS;
DROP TABLE PATIENT_TREATMENT CASCADE CONSTRAINTS;
DROP TABLE PATIENT_DOCTOR CASCADE CONSTRAINTS;
DROP TABLE DOCTOR_TREATMENT CASCADE CONSTRAINTS;
DROP TABLE TREATMENT_INTERN CASCADE CONSTRAINTS;
DROP TABLE PATIENT CASCADE CONSTRAINTS;
DROP TABLE DEPARTMENT CASCADE CONSTRAINTS;
DROP TABLE DOCTOR CASCADE CONSTRAINTS;
DROP TABLE TREATMENT CASCADE CONSTRAINTS;
DROP TABLE MEDICATION CASCADE CONSTRAINTS;
DROP TABLE ROOM CASCADE CONSTRAINTS;
DROP TABLE INTERN CASCADE CONSTRAINTS;
DROP TABLE ADMIN_TABLE CASCADE CONSTRAINTS;
DROP TABLE PATIENT_TABLE CASCADE CONSTRAINTS;
DROP TABLE INTERN_TABLE CASCADE CONSTRAINTS;
DROP TABLE DOCTOR_TABLE CASCADE CONSTRAINTS;

-- Table creation in correct order
CREATE TABLE INTERN (
    InternID INT CONSTRAINT InternID_pk PRIMARY KEY,
    Name VARCHAR(20) NOT NULL,
    College VARCHAR(20),
    Year INT
);

CREATE TABLE ROOM (
    RoomID INT PRIMARY KEY,
    Type VARCHAR(20),
    Capacity INT
);

CREATE TABLE DOCTOR (
    DoctorID INT PRIMARY KEY,
    Name VARCHAR(20) NOT NULL,
    Speciality VARCHAR(20),
    InternID INT,
    CONSTRAINT fk_doctor_intern FOREIGN KEY (InternID) REFERENCES INTERN(InternID) ON DELETE SET NULL
);

CREATE TABLE TREATMENT (
    TreatmentID INT CONSTRAINT TreatmentID_pk PRIMARY KEY,
    TreatmentType VARCHAR(20),
    Cost INT
);

CREATE TABLE MEDICATION (
    MedID INT PRIMARY KEY,
    Name VARCHAR(20),
    Dosage INT,
    SideEffects VARCHAR(100)
);

CREATE TABLE PATIENT (
    PatientID INT PRIMARY KEY,
    First_Name VARCHAR(20) NOT NULL,
    Last_Name VARCHAR(20),
    MedicalHistory VARCHAR(20),
    Contact INT,
    DOB DATE,
    RoomID INT,
    CONSTRAINT fk_patient_room FOREIGN KEY (RoomID) REFERENCES ROOM(RoomID) ON DELETE SET NULL
);

CREATE TABLE DEPARTMENT (
    DeptID INT CONSTRAINT DeptID_pk PRIMARY KEY,
    DeptName VARCHAR(20),
    ManagerID INT,
    CONSTRAINT fk_dept_doctor FOREIGN KEY (ManagerID) REFERENCES DOCTOR(DoctorID) ON DELETE SET NULL
);

-- Junction tables
CREATE TABLE DOCTOR_TREATMENT (
    TreatmentID INT,
    DoctorID INT,
    CONSTRAINT fk_dt_treatment FOREIGN KEY (TreatmentID) REFERENCES TREATMENT(TreatmentID) ON DELETE SET NULL,
    CONSTRAINT fk_dt_doctor FOREIGN KEY (DoctorID) REFERENCES DOCTOR(DoctorID) ON DELETE SET NULL
);

CREATE TABLE TREATMENT_INTERN (
    TreatmentID INT,
    InternID INT,
    CONSTRAINT fk_ti_treatment FOREIGN KEY (TreatmentID) REFERENCES TREATMENT(TreatmentID) ON DELETE SET NULL,
    CONSTRAINT fk_ti_intern FOREIGN KEY (InternID) REFERENCES INTERN(InternID) ON DELETE SET NULL
);

CREATE TABLE PATIENT_DOCTOR (
    PatientID INT,
    DoctorID INT,
    CONSTRAINT fk_pd_doctor FOREIGN KEY (DoctorID) REFERENCES DOCTOR(DoctorID) ON DELETE SET NULL,
    CONSTRAINT fk_pd_patient FOREIGN KEY (PatientID) REFERENCES PATIENT(PatientID) ON DELETE SET NULL
);

CREATE TABLE PATIENT_TREATMENT (
    PatientID INT,
    TreatmentID INT,
    CONSTRAINT fk_pt_treatment FOREIGN KEY (TreatmentID) REFERENCES TREATMENT(TreatmentID) ON DELETE SET NULL,
    CONSTRAINT fk_pk_patient FOREIGN KEY (PatientID) REFERENCES PATIENT(PatientID) ON DELETE SET NULL
);

CREATE TABLE BILL (
    BillNumber INT,
    PatientID INT,
    Amount INT,
    DateIssued DATE,
    CONSTRAINT pk_bill PRIMARY KEY (BillNumber, PatientID),
    CONSTRAINT fk_bill_patient FOREIGN KEY (PatientID) REFERENCES PATIENT(PatientID) ON DELETE SET NULL
);

CREATE TABLE DOCTOR_MEDICATION (
    DoctorID INT,
    MedicationID INT,
    CONSTRAINT fk_dm_doctor FOREIGN KEY (DoctorID) REFERENCES DOCTOR(DoctorID) ON DELETE SET NULL,
    CONSTRAINT fk_dm_medication FOREIGN KEY (MedicationID) REFERENCES MEDICATION(MedID) ON DELETE SET NULL
);

CREATE TABLE PATIENT_MEDICATION (
    PatientID INT,
    MedID INT,
    CONSTRAINT fk_pm_patient FOREIGN KEY (PatientID) REFERENCES PATIENT(PatientID) ON DELETE SET NULL,
    CONSTRAINT fk_pm_medication FOREIGN KEY (MedID) REFERENCES MEDICATION(MedID) ON DELETE SET NULL
);

CREATE TABLE WORKS_IN (
    DoctorID INT,
    DeptID INT,
    CONSTRAINT fk_wi_doctor FOREIGN KEY (DoctorID) REFERENCES DOCTOR(DoctorID) ON DELETE SET NULL,
    CONSTRAINT fk_wi_dept FOREIGN KEY (DeptID) REFERENCES DEPARTMENT(DeptID) ON DELETE SET NULL
);

CREATE TABLE ADMIN_TABLE(
    adminID INT CONSTRAINT adminID PRIMARY KEY,
    password VARCHAR(20)
);

-- Insert data (same as original)
INSERT INTO INTERN VALUES (201, 'Riya', 'AIIMS', 3);
INSERT INTO INTERN VALUES (202, 'Karan', 'CMC', 4);
INSERT INTO INTERN VALUES (203, 'Nisha', 'KMC', 2);

INSERT INTO DOCTOR VALUES (301, 'Dr. Mehta', 'Cardiology', 201);
INSERT INTO DOCTOR VALUES (302, 'Dr. Rao', 'Neurology', 202);
INSERT INTO DOCTOR VALUES (303, 'Dr. Iyer', 'Orthopedics', NULL);

INSERT INTO TREATMENT VALUES (501, 'Surgery', 50000);
INSERT INTO TREATMENT VALUES (502, 'Therapy', 15000);
INSERT INTO TREATMENT VALUES (503, 'Consultation', 2000);

INSERT INTO DOCTOR_TREATMENT VALUES (501, 301);
INSERT INTO DOCTOR_TREATMENT VALUES (502, 302);
INSERT INTO DOCTOR_TREATMENT VALUES (503, 303);

INSERT INTO TREATMENT_INTERN VALUES (501, 201);
INSERT INTO TREATMENT_INTERN VALUES (502, 202);

INSERT INTO ROOM VALUES (101, 'General', 4);
INSERT INTO ROOM VALUES (102, 'Private', 1);
INSERT INTO ROOM VALUES (103, 'ICU', 2);

INSERT INTO PATIENT VALUES (101, 'Amit', 'Sharma', 'Diabetes', 9876543210, TO_DATE('1990-05-12','YYYY-MM-DD'), 101);
INSERT INTO PATIENT VALUES (102, 'Sneha', 'Kapoor', 'Hypertension', 8765432109, TO_DATE('1985-10-20','YYYY-MM-DD'), 102);
INSERT INTO PATIENT VALUES (103, 'Ravi', 'Verma', 'Fracture', 7654321098, TO_DATE('2000-03-08','YYYY-MM-DD'), 103);

INSERT INTO PATIENT_DOCTOR VALUES (101, 301);
INSERT INTO PATIENT_DOCTOR VALUES (102, 302);
INSERT INTO PATIENT_DOCTOR VALUES (103, 303);

INSERT INTO PATIENT_TREATMENT VALUES (101, 501);
INSERT INTO PATIENT_TREATMENT VALUES (102, 502);
INSERT INTO PATIENT_TREATMENT VALUES (103, 503);

INSERT INTO BILL VALUES (1, 101, 52000, TO_DATE('2025-01-10','YYYY-MM-DD'));
INSERT INTO BILL VALUES (2, 102, 16000, TO_DATE('2025-01-15','YYYY-MM-DD'));
INSERT INTO BILL VALUES (3, 103, 2500, TO_DATE('2025-01-18','YYYY-MM-DD'));

INSERT INTO MEDICATION VALUES (601, 'Paracetamol', 500, 'Drowsiness');
INSERT INTO MEDICATION VALUES (602, 'Ibuprofen', 200, 'Stomach upset');
INSERT INTO MEDICATION VALUES (603, 'Amoxicillin', 250, 'Allergy');

INSERT INTO DOCTOR_MEDICATION VALUES (301, 601);
INSERT INTO DOCTOR_MEDICATION VALUES (302, 602);
INSERT INTO DOCTOR_MEDICATION VALUES (303, 603);

INSERT INTO PATIENT_MEDICATION VALUES (101, 601);
INSERT INTO PATIENT_MEDICATION VALUES (102, 602);
INSERT INTO PATIENT_MEDICATION VALUES (103, 603);

INSERT INTO DEPARTMENT VALUES (901, 'Cardiology', 301);
INSERT INTO DEPARTMENT VALUES (902, 'Neurology', 302);
INSERT INTO DEPARTMENT VALUES (903, 'Orthopedics', 303);

INSERT INTO WORKS_IN VALUES (301, 901);
INSERT INTO WORKS_IN VALUES (302, 902);
INSERT INTO WORKS_IN VALUES (303, 903);

INSERT INTO ADMIN_TABLE VALUES(1, 'HelloWorld2006');
INSERT INTO ADMIN_TABLE VALUES(2, 'Hello');

-- Creating PATIENT_TABLE
CREATE TABLE PATIENT_TABLE (
    PatientID INT PRIMARY KEY,
    Password VARCHAR(20)
);

-- Inserting values into PATIENT_TABLE
INSERT INTO PATIENT_TABLE VALUES (101, 'pat@123');
INSERT INTO PATIENT_TABLE VALUES (102, 'pat@456');
INSERT INTO PATIENT_TABLE VALUES (103, 'pat@789');

-- Creating INTERN_TABLE
CREATE TABLE INTERN_TABLE (
    InternID INT PRIMARY KEY,
    Password VARCHAR(20)
);

-- Inserting values into INTERN_TABLE
INSERT INTO INTERN_TABLE VALUES (201, 'int@123');
INSERT INTO INTERN_TABLE VALUES (202, 'int@456');
INSERT INTO INTERN_TABLE VALUES (203, 'int@789');

-- Creating DOCTOR_TABLE
CREATE TABLE DOCTOR_TABLE (
    DoctorID INT PRIMARY KEY,
    Password VARCHAR(20)
);

-- Inserting values into DOCTOR_TABLE
INSERT INTO DOCTOR_TABLE VALUES (301, 'doc@123');
INSERT INTO DOCTOR_TABLE VALUES (302, 'doc@456');
INSERT INTO DOCTOR_TABLE VALUES (303, 'doc@789');

COMMIT;